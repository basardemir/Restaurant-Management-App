

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Mehmet Can Gün &mdash; ITUCSDB1951  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parts Implemented by Uğur Demir" href="member4.html" />
    <link rel="prev" title="Parts Implemented by Metehan Seyran" href="member2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1951
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#database-design">Database Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code">Code</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="member1.html">Parts Implemented by İbrahim Berat Kaya</a></li>
<li class="toctree-l3"><a class="reference internal" href="member2.html">Parts Implemented by Metehan Seyran</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Parts Implemented by Mehmet Can Gün</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#code-structure">CODE STRUCTURE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#company">COMPANY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#card">CARD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#order">ORDER</a></li>
<li class="toctree-l4"><a class="reference internal" href="#order-food">ORDER_FOOD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comment">COMMENT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="member4.html">Parts Implemented by Uğur Demir</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1951</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Mehmet Can Gün</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/member3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-mehmet-can-gun">
<h1>Parts Implemented by Mehmet Can Gün<a class="headerlink" href="#parts-implemented-by-mehmet-can-gun" title="Permalink to this headline">¶</a></h1>
<div class="section" id="code-structure">
<h2>CODE STRUCTURE<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>We basically implement the MVC pattern, which is Modal, View, Controller approach. This method provides us to use our methods by calling in a structure.</p>
<div class="section" id="models-folder">
<h3>Models Folder<a class="headerlink" href="#models-folder" title="Permalink to this headline">¶</a></h3>
<p>Containing database connection codes for forms.</p>
<ul class="simple">
<li><p>company.py</p></li>
<li><p>card.py</p></li>
<li><p>order.py</p></li>
</ul>
</div>
<div class="section" id="pages-folder">
<h3>Pages Folder<a class="headerlink" href="#pages-folder" title="Permalink to this headline">¶</a></h3>
<p>Containing pages to be connected with views page.</p>
<ul class="simple">
<li><p>company.py</p></li>
<li><p>card.py</p></li>
<li><p>order.py</p></li>
</ul>
</div>
<div class="section" id="forms-folder-in-pages-folder">
<h3>Forms Folder in Pages Folder<a class="headerlink" href="#forms-folder-in-pages-folder" title="Permalink to this headline">¶</a></h3>
<p>Containing wtfforms forms to be called in pages and used in views.</p>
<p>Also, forms contains validations.</p>
<ul class="simple">
<li><p>company_form.py</p></li>
<li><p>card_form.py</p></li>
<li><p>order_form.py</p></li>
<li><p>comment_form.py</p></li>
</ul>
</div>
<div class="section" id="views-py">
<h3>views.py<a class="headerlink" href="#views-py" title="Permalink to this headline">¶</a></h3>
<p>Containing the pages for import to use in urls.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">views.py</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pages.company</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pages.card</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pages.order</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="util-py">
<h3>util.py<a class="headerlink" href="#util-py" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">This file is used only for adding ‘list’ into Flask urls in order to convert urls in spite of html markup.</div>
<div class="line">Basically, if you send list with link, then the url shows data seperated by comma.</div>
<div class="line"><a class="reference internal" href="#id17" id="id1"><span>[util.py]</span></a> ListConventer is implemented with BaseConverter</div>
<div class="line">In the 4-5 lines of <strong>server.py</strong>, adding the list to flask map structure</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">util.py</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Code retrieved from : https://exploreflask.com/en/latest/views.html#custom-converters</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="kn">import</span> <span class="n">BaseConverter</span>

<span class="k">class</span> <span class="nc">ListConverter</span><span class="p">(</span><span class="n">BaseConverter</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BaseConverter</span><span class="o">.</span><span class="n">to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">server.py</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">## start </span>
<span class="c1"># https://exploreflask.com/en/latest/views.html#custom-converters</span>

<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">ListConverter</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">converters</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ListConverter</span>

<span class="c1">## end</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="company">
<h2>COMPANY<a class="headerlink" href="#company" title="Permalink to this headline">¶</a></h2>
<p>Company class is connected to user class as a founder info and to contact info to keep companies information to the system.</p>
<ul class="simple">
<li><p>Primary Key: COMPANY_ID</p></li>
<li><p>Non-relational Key</p>
<ul>
<li><p>NAME</p></li>
<li><p>INFORMATION</p></li>
<li><p>MISSION</p></li>
<li><p>ABBREVATION</p></li>
<li><p>FOUNDATION_DATE</p></li>
<li><p>TYPE( Limited or Anonymous )</p></li>
</ul>
</li>
<li><p>Foreign Key(table_name)</p>
<ul>
<li><p>USER_ID(USERACCOUNT)</p></li>
<li><p>CONTACT_ID(CONTACT_INFO)</p></li>
</ul>
</li>
</ul>
<div class="section" id="database-functions">
<h3>Database Functions<a class="headerlink" href="#database-functions" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">This method get all companies in <strong>index page of company</strong></span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_all_companies</span><span class="p">():</span>
  <span class="n">companies</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from company&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">companies</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">This method get company in <strong>detail page of company</strong></span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from company where company_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">company_key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">company</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">company</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">This method add company in <strong>add page of company</strong></span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_company</span><span class="p">(</span><span class="n">company</span><span class="p">):</span>
  <span class="n">company_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into company(name, information, mission, vision, abbrevation, foundation_date, type, user_id, contact_id) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) RETURNING company_id;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">company</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
      <span class="n">company_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">company_id</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">This method update company in <strong>update page of company</strong></span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_company</span><span class="p">(</span><span class="n">company</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update company set name = </span><span class="si">%s</span><span class="s2">, information = </span><span class="si">%s</span><span class="s2">, mission = </span><span class="si">%s</span><span class="s2">, vision = </span><span class="si">%s</span><span class="s2">, abbrevation = </span><span class="si">%s</span><span class="s2">, foundation_date = </span><span class="si">%s</span><span class="s2">, type = </span><span class="si">%s</span><span class="s2"> where company_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">company</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">This method delete company in <strong>delete page of company</strong></span><a class="headerlink" href="#id25" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from company where company_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">company_key</span><span class="p">,)</span> <span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="other-functions">
<h3>Other functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">Getting <strong>contact information</strong> of company by <strong>contact_id</strong></span><a class="headerlink" href="#id26" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_contact_of_company</span><span class="p">(</span><span class="n">contact_id</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from contactinfo where id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">contact_id</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">contact</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">Getting <strong>id and name</strong> of companies to show in card list as choices.</span><a class="headerlink" href="#id27" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from company where company_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">company_key</span><span class="p">,)</span> <span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">Getting company by <strong>user key</strong>.</span><a class="headerlink" href="#id28" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_company_by_user</span><span class="p">(</span><span class="n">user_key</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from company where user_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">user_key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">company</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">company</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text"><strong>Update the founder</strong> information of company.</span><a class="headerlink" href="#id29" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from company where company_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">company_key</span><span class="p">,)</span> <span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="forms">
<h3>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h3>
<p>Company and Founder Form using in pages are made with wtfforms components.</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">import section of company_form.</span><a class="headerlink" href="#id30" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">SubmitField</span><span class="p">,</span> <span class="n">FormField</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">FieldList</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span>
<span class="kn">from</span> <span class="nn">wtforms.fields.html5</span> <span class="kn">import</span> <span class="n">DateField</span>
<span class="c1">#from wtforms.fields.html5 import DateTimeLocalField</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">..forms.users_form</span> <span class="kn">import</span> <span class="n">UserAccountForm</span><span class="p">,</span> <span class="n">ContactInfoForm</span><span class="p">,</span> <span class="n">PersonForm</span>

<span class="kn">from</span> <span class="nn">models.users</span> <span class="kn">import</span> <span class="n">select_users</span>

<span class="n">msgRequired</span> <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> must be filled.&quot;</span>
<span class="n">msgChosen</span>   <span class="o">=</span> <span class="s2">&quot;Must choose one </span><span class="si">{}</span><span class="s2"> of them.&quot;</span>

<span class="n">typeChoices</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;Choose one!&#39;</span><span class="p">),</span> 
  <span class="p">(</span><span class="s1">&#39;LTD&#39;</span><span class="p">,</span> <span class="s1">&#39;Limited&#39;</span><span class="p">),</span> 
  <span class="p">(</span><span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;Anonim&#39;</span><span class="p">)</span>
<span class="p">]</span>
<span class="k">def</span> <span class="nf">get_usernames</span><span class="p">():</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">select_users</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">Company Abstract Class</span><a class="headerlink" href="#id31" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="s2">&quot;Name&quot;</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="p">)],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">information</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="s2">&quot;Information&quot;</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Information&quot;</span><span class="p">))</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">mission</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="s2">&quot;Mission&quot;</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Mission&quot;</span><span class="p">))</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">vision</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="s2">&quot;Vision&quot;</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Vision&quot;</span><span class="p">))</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">abbrevation</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="s2">&quot;Abbrevation&quot;</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Abbrevation&quot;</span><span class="p">))</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">foundation_date</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">(</span>
    <span class="s1">&#39;Founded Date&#39;</span><span class="p">,</span> 
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="nb">type</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="s2">&quot;Type&quot;</span><span class="p">,</span> 
    <span class="n">choices</span> <span class="o">=</span> <span class="n">typeChoices</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">unselectedValid</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">CompanyForm Class instanced from Company and ContactInfo class</span><a class="headerlink" href="#id32" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CompanyForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">company</span>   <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span>
  <span class="n">contact</span>   <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">ContactInfoForm</span><span class="p">)</span>
  <span class="n">submit</span>    <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span> <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">Founder( class )</span><a class="headerlink" href="#id33" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Founder</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">username</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="s2">&quot;Select your new boss&quot;</span><span class="p">,</span>
    <span class="n">coerce</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="n">get_usernames</span><span class="p">(),</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">FounderForm( instanced from Founder )</span><a class="headerlink" href="#id34" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FounderForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">founder</span>  <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">Founder</span><span class="p">)</span>
  <span class="n">submit</span>   <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span> <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="pages">
<h3>Pages<a class="headerlink" href="#pages" title="Permalink to this headline">¶</a></h3>
<p>Pages connected to forms, views and call database operations.</p>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">Company Index Page</span><a class="headerlink" href="#id35" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">companies_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">companies</span> <span class="o">=</span> <span class="n">get_all_companies</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/companies/index.html&quot;</span><span class="p">,</span> <span class="n">companies</span> <span class="o">=</span> <span class="n">companies</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">Company Add Page</span><a class="headerlink" href="#id36" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">company_add_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">CompanyForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">company</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      <span class="n">user_id</span>     <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]</span>
      <span class="n">contact_id</span>  <span class="o">=</span> <span class="n">insert_contactinfo</span><span class="p">(</span><span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

      <span class="n">company_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;mission&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;vision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;abbrevation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;foundation_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">contact_id</span>
      <span class="p">)</span>

      <span class="n">company_key</span> <span class="o">=</span> <span class="n">add_company</span><span class="p">(</span><span class="n">company_info</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;company_details_page&quot;</span><span class="p">,</span> <span class="n">company_key</span> <span class="o">=</span> <span class="n">company_key</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/companies/create.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">company</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">Company Delete Page</span><a class="headerlink" href="#id37" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">company_delete_page</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
      <span class="n">delete_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;companies_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/companies/delete.html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">Company Update Page</span><a class="headerlink" href="#id38" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">company_update_page</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">_company</span> <span class="o">=</span> <span class="n">get_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">_company</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    
    <span class="n">_contact</span>  <span class="o">=</span> <span class="n">get_contact_of_company</span><span class="p">(</span><span class="n">_company</span><span class="p">[</span><span class="s1">&#39;contact_id&#39;</span><span class="p">])</span>
    <span class="n">company</span>   <span class="o">=</span> <span class="n">CompanyForm</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">company</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>

      <span class="n">company_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;mission&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;vision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;abbrevation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;foundation_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">company_key</span>
      <span class="p">)</span>
      <span class="n">update_contactinfo_with_id</span><span class="p">(</span><span class="n">_company</span><span class="p">[</span><span class="s2">&quot;contact_id&quot;</span><span class="p">],</span> <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
      <span class="n">update_company</span><span class="p">(</span><span class="n">company_info</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;company_details_page&quot;</span><span class="p">,</span> <span class="n">company_key</span> <span class="o">=</span> <span class="n">company_key</span><span class="p">)</span> <span class="p">)</span>

    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>             <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;mission&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>          <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;mission&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;vision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>           <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;vision&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;abbrevation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;abbrevation&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;foundation_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>  <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;foundation_date&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">company</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>             <span class="o">=</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">_company</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="p">[</span><span class="s2">&quot;phoneNumber&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="n">_contact</span><span class="p">[</span><span class="s2">&quot;phonenumber&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>            <span class="o">=</span> <span class="n">_contact</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="p">[</span><span class="s2">&quot;fax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>              <span class="o">=</span> <span class="n">_contact</span><span class="p">[</span><span class="s2">&quot;fax&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="p">[</span><span class="s2">&quot;homePhone&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>        <span class="o">=</span> <span class="n">_contact</span><span class="p">[</span><span class="s2">&quot;homephone&quot;</span><span class="p">]</span>
    <span class="n">company</span><span class="o">.</span><span class="n">contact</span><span class="p">[</span><span class="s2">&quot;workmail&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>         <span class="o">=</span> <span class="n">_contact</span><span class="p">[</span><span class="s2">&quot;workmail&quot;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/companies/update.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">company</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">Company Details Page</span><a class="headerlink" href="#id39" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">company_details_page</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>

  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">get_company</span><span class="p">(</span><span class="n">company_key</span><span class="p">)</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="n">get_contact_of_company</span><span class="p">(</span> <span class="n">company</span><span class="p">[</span><span class="s1">&#39;contact_id&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">founder</span> <span class="o">=</span> <span class="n">select_a_user_and_info</span><span class="p">(</span> <span class="n">company</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">founder</span><span class="p">:</span>
      <span class="n">founder</span> <span class="o">=</span> <span class="n">founder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">company</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/companies/details.html&quot;</span><span class="p">,</span>
      <span class="n">company</span> <span class="o">=</span> <span class="n">company</span><span class="p">,</span>
      <span class="n">contact</span> <span class="o">=</span> <span class="n">contact</span><span class="p">,</span>
      <span class="n">founder</span> <span class="o">=</span> <span class="n">founder</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">Company Set Founder Page</span><a class="headerlink" href="#id40" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">company_setfounder_page</span><span class="p">(</span><span class="n">company_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">founder</span> <span class="o">=</span> <span class="n">FounderForm</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">founder</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      
      <span class="n">update_company_founder</span><span class="p">(</span> 
        <span class="p">(</span> <span class="n">founder</span><span class="o">.</span><span class="n">founder</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">company_key</span> <span class="p">)</span>
      <span class="p">)</span>

      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;companies_page&quot;</span><span class="p">))</span>

    <span class="n">founder</span><span class="o">.</span><span class="n">founder</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/companies/set_founder.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">founder</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="views">
<h3>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-text">List Companies if companies exists.</span><a class="headerlink" href="#id41" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    {% if companies %}
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light table-hover&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Information<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Mission<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Vision<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Abbrevation<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Founded Date<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Type<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Operations<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        {% for i in companies %}
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;name&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;information&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;mission&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;vision&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;abbrevation&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;foundation_date&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;type&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;company_details_page&#39;, company_key = i[&#39;company_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info&quot;</span><span class="p">&gt;</span>Details <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;company_update_page&#39;, company_key = i[&#39;company_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-warning&quot;</span><span class="p">&gt;</span>Update<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;company_delete_page&#39;, company_key = i[&#39;company_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-danger&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% if not i[&#39;user_id&#39;] %}
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;company_setfounder_page&#39;, company_key = i[&#39;company_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-warning&quot;</span><span class="p">&gt;</span>Set Founder<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endif%}
          <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    {% endif %}
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-text">Adding Company after join as Boss.</span><a class="headerlink" href="#id42" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[i][0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endfor %}
    {% endfor %}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Create <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>company<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {{ form.company( class_ = &quot;mt-5 table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Complete <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>contact<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>  
    {{ form.contact( class_ = &quot;mt-5 table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-right&quot;</span><span class="p">&gt;</span>If you cannot find your location, you can create by using link below<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;location_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right btn btn-dark&quot;</span><span class="p">&gt;</span>Add Location<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;companies_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-text">Update details about company.</span><a class="headerlink" href="#id43" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[i][0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endfor %}
    {% endfor %}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Update <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>company<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {{ form.company( class_ = &quot;mt-5 table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Update <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>contact<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>  
    {{ form.contact( class_ = &quot;mt-5 table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;companies_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-text">Update details about boss of company.</span><a class="headerlink" href="#id44" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[i][0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endfor %}
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Set Founder to <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>company<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {{ form.founder(class_ = &quot;mt-5 table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;companies_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id45">
<div class="code-block-caption"><span class="caption-text">Confirm the delete operation.</span><a class="headerlink" href="#id45" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Are you sure to delete your company?<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;companies_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-text">Lists details about company information, boss information and contact information</span><a class="headerlink" href="#id46" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{% if company %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-12 row&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-6&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Company <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Name: {{ company[&quot;name&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Information: {{ company[&quot;information&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Mission: {{ company[&quot;mission&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Vision: {{ company[&quot;vision&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Abbrevation: {{ company[&quot;abbrevation&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Foundation Date: {{ company[&quot;foundation_date&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Company Type: {{ company[&quot;type&quot;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-6&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4 &quot;</span><span class="p">&gt;</span>Founder<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
        {% if founder %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ founder[&#39;path&#39;] }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;img-fluid round-circle&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;250&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;250&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Founder: {{ founder[&#39;name&#39;] }} {{ founder[&#39;surname&#39;]  }}  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Gender: {{ founder[&#39;gender&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Birthday: {{ founder[&#39;birthday&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Education Level: {{ founder[&#39;educationlevel&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        {% else %}
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This company has no founder yet.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        {% endif %}
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4 &quot;</span><span class="p">&gt;</span>Contact to Company<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Phone Number: {{ contact[&#39;phonenumber &#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Email: {{ contact[&#39;email&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Fax: {{ contact[&#39;fax&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>2nd Phone Number: {{ contact[&#39;homephone&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Work Mail: {{ contact[&#39;workmail&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endif %}
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="card">
<h2>CARD<a class="headerlink" href="#card" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Card class is connected to user class with respect to company and to connect to company for specialize card for the company.</div>
</div>
<ul class="simple">
<li><p>Primary Key: CARD_ID</p></li>
<li><p>Non-relational Key:</p>
<ul>
<li><p>POINTS</p></li>
<li><p>CARD_NUMBER( UNIQUE )</p></li>
<li><p>IS_ACTIVE</p></li>
<li><p>COLOR</p></li>
<li><p>ACTIVATION_DATE( now ),</p></li>
<li><p>EXPIRE_DATE( default = added 1 year from now )</p></li>
</ul>
</li>
<li><p>Foreign Key(table_name)</p>
<ul>
<li><p>USER_ID(USERACCOUNT)</p></li>
<li><p>COMPANY_ID(COMPANY)</p></li>
</ul>
</li>
</ul>
<div class="section" id="id2">
<h3>Database Functions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id47">
<div class="code-block-caption"><span class="caption-text">This method get all cards in <strong>index page of card</strong></span><a class="headerlink" href="#id47" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_all_cards</span><span class="p">():</span>
  <span class="n">cards</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select card_id, p.name as name, color , p.surname as surname, points, expire_date, card_number, com.name as company from card left outer join company as com on card.company_id = com.company_id left join useraccount as users on card.user_id = users.id inner join person as p on p.id = users.person&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">cards</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-text">This method get card in <strong>detail page of card</strong></span><a class="headerlink" href="#id48" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_card</span><span class="p">(</span><span class="n">card_key</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select username, CONCAT(p.name,&#39; &#39;,p.surname) as person_name, color, ph.path as path, p.birthDay, p.educationLevel, p.gender, card_number, points, is_active, activation_date, expire_date, card.company_id as company_id, c.name as company_name, c.information as company_information from card full join useraccount on card.user_id = useraccount.id full join company as c on c.company_id = card.company_id full join person as p on p.id = useraccount.person full join photo as ph on p.photo = ph.id where card_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">card_key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">card</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id49">
<div class="code-block-caption"><span class="caption-text">This method add card in <strong>add page of card</strong></span><a class="headerlink" href="#id49" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="n">card</span><span class="p">):</span>
  <span class="n">card_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into card(points, card_number, is_active, color, expire_date, user_id, company_id) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) RETURNING card_id;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">card</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
      <span class="n">card_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">card_id</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-text">This method update card in <strong>update page of card</strong></span><a class="headerlink" href="#id50" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_card</span><span class="p">(</span><span class="n">card</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update card set points = </span><span class="si">%s</span><span class="s2">, card_number = </span><span class="si">%s</span><span class="s2">, is_active = </span><span class="si">%s</span><span class="s2">, color = </span><span class="si">%s</span><span class="s2">, expire_date = </span><span class="si">%s</span><span class="s2">, user_id = </span><span class="si">%s</span><span class="s2">, company_id=</span><span class="si">%s</span><span class="s2"> where card_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">card</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-text">This method delete card in <strong>delete page of card</strong></span><a class="headerlink" href="#id51" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_card</span><span class="p">(</span><span class="n">card_key</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from card where card_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">card_key</span><span class="p">,)</span> <span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id3">
<h3>Other functions<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-text">This method checks the card number does exist or not in cards.</span><a class="headerlink" href="#id52" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_card_number</span><span class="p">(</span><span class="n">card_number</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select COUNT(*) from card where card_number = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">card_number</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id53">
<div class="code-block-caption"><span class="caption-text">Getting card information by user_key in order to use in my_card page.</span><a class="headerlink" href="#id53" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_card_by_user</span><span class="p">(</span><span class="n">user_key</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select username, CONCAT(p.name,&#39; &#39;,p.surname) as person_name, color, ph.path as path, p.birthDay, p.educationLevel, p.gender, card_number, points, is_active, activation_date, expire_date, card.company_id as company_id, c.name as company_name, c.information as company_information from card inner join useraccount on card.user_id = useraccount.id full join company as c on c.company_id = card.company_id full join person as p on p.id = useraccount.person full join photo as ph on p.photo = ph.id where useraccount.id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">user_key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">card</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id4">
<h3>Forms<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>CardForm is used in pages.</p>
<div class="literal-block-wrapper docutils container" id="id54">
<div class="code-block-caption"><span class="caption-text">import section of card_form</span><a class="headerlink" href="#id54" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">SelectField</span><span class="p">,</span> <span class="n">FormField</span><span class="p">,</span> <span class="n">SubmitField</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">RadioField</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Length</span>
<span class="kn">from</span> <span class="nn">wtforms_components</span> <span class="kn">import</span> <span class="n">IntegerField</span><span class="p">,</span> <span class="n">ColorField</span>
<span class="kn">from</span> <span class="nn">wtforms.fields.html5</span> <span class="kn">import</span> <span class="n">DateField</span>
<span class="c1">#from colour import Color</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">session</span>

<span class="kn">from</span> <span class="nn">models.card</span> <span class="kn">import</span> <span class="n">check_card_number</span>
<span class="kn">from</span> <span class="nn">models.users</span> <span class="kn">import</span> <span class="n">check_if_user_exists</span><span class="p">,</span> <span class="n">select_a_user_and_info</span><span class="p">,</span> <span class="n">get_user_by_username</span>


<span class="n">msgRequired</span> <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> must be filled.&quot;</span>
<span class="n">msgChosen</span>   <span class="o">=</span> <span class="s2">&quot;Must choose one </span><span class="si">{}</span><span class="s2"> of them.&quot;</span>
<span class="n">msgValidations</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">&quot;Username not found.&quot;</span><span class="p">,</span>
  <span class="s2">&quot;This user is not a customer!&quot;</span>
<span class="p">]</span>
<span class="n">typeChoices</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Inactive&#39;</span><span class="p">),</span> 
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Active&#39;</span><span class="p">)</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">checkUser</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
  
  <span class="k">if</span> <span class="ow">not</span> <span class="n">check_if_user_exists</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">}</span> <span class="p">):</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msgValidations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span>
    
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_user_by_username</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">select_a_user_and_info</span><span class="p">(</span> <span class="n">user_id</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="s1">&#39;Customer&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msgValidations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id55">
<div class="code-block-caption"><span class="caption-text">Card class for Form</span><a class="headerlink" href="#id55" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Card</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">points</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span>
    <span class="s2">&quot;Points&quot;</span><span class="p">,</span>
    <span class="n">default</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;points&quot;</span><span class="p">))],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
  
  <span class="n">is_active</span> <span class="o">=</span> <span class="n">RadioField</span><span class="p">(</span>
    <span class="s2">&quot;Is Active&quot;</span><span class="p">,</span>
    <span class="n">default</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="n">typeChoices</span><span class="p">,</span> 
    <span class="n">coerce</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;active state&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;list-group list-group-horizontal&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">color</span> <span class="o">=</span> <span class="n">ColorField</span><span class="p">(</span>
    <span class="s2">&quot;Color&quot;</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Optional</span><span class="p">()</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span><span class="p">}</span>
  <span class="p">)</span>

  <span class="n">expire_date</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">(</span>
    <span class="s1">&#39;Expire Date&#39;</span><span class="p">,</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">(</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">365</span><span class="p">))</span> <span class="p">),</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">card_number</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="s2">&quot;Card Number&quot;</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span> <span class="p">[</span> <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The column size must be 16&quot;</span> <span class="p">)],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;form-control&quot;</span><span class="p">,</span> <span class="s2">&quot;readonly&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id56">
<div class="code-block-caption"><span class="caption-text">CardForm includes Card class</span><a class="headerlink" href="#id56" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CardForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">card</span>      <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">Card</span><span class="p">)</span>
  <span class="n">username</span>  <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="s2">&quot;Username&quot;</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">checkUser</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
  <span class="n">submit</span>    <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span> <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id5">
<h3>Pages<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Pages connected to forms, views and call database operations.</p>
<div class="literal-block-wrapper docutils container" id="id57">
<div class="code-block-caption"><span class="caption-text">Card Index Page</span><a class="headerlink" href="#id57" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cards_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">cards</span> <span class="o">=</span> <span class="n">get_all_cards</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/cards/index.html&quot;</span><span class="p">,</span> <span class="n">cards</span> <span class="o">=</span> <span class="n">cards</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-text">Card Add Page</span><a class="headerlink" href="#id58" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">card_add_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">CardForm</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">checkCardNumber</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;card_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">x</span><span class="p">:</span>
      
      <span class="n">user_key</span>    <span class="o">=</span> <span class="n">get_user_by_username</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
      <span class="n">company_key</span> <span class="o">=</span> <span class="n">get_company_by_user</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">])[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span>
      
      <span class="n">card_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;card_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;expire_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">user_key</span><span class="p">,</span>
        <span class="n">company_key</span>
      <span class="p">)</span>

      <span class="n">card_key</span> <span class="o">=</span> <span class="n">add_card</span><span class="p">(</span><span class="n">card_info</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;card_details_page&quot;</span><span class="p">,</span> <span class="n">card_key</span> <span class="o">=</span> <span class="n">card_key</span><span class="p">))</span>
    
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s1">&#39;card_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">uniqueValue</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/cards/create.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">card</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id59">
<div class="code-block-caption"><span class="caption-text">Card Delete Page</span><a class="headerlink" href="#id59" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">card_delete_page</span><span class="p">(</span><span class="n">card_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
      <span class="n">delete_card</span><span class="p">(</span><span class="n">card_key</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;cards_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/cards/delete.html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id60">
<div class="code-block-caption"><span class="caption-text">Card Update Page</span><a class="headerlink" href="#id60" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">card_update_page</span><span class="p">(</span><span class="n">card_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;membershiptype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Boss&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;access_denied_page&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">_card</span> <span class="o">=</span> <span class="n">get_card</span><span class="p">(</span><span class="n">card_key</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_card</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">CardForm</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      <span class="n">user_key</span>    <span class="o">=</span> <span class="n">get_user_by_username</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
      <span class="n">company_key</span> <span class="o">=</span> <span class="n">get_company_by_user</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">])[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span>
      
      <span class="n">card_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;card_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
        <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;expire_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">user_key</span><span class="p">,</span>
        <span class="n">company_key</span><span class="p">,</span>
        <span class="n">card_key</span>
      <span class="p">)</span>
      <span class="n">update_card</span><span class="p">(</span><span class="n">card_info</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;card_details_page&quot;</span><span class="p">,</span> <span class="n">card_key</span> <span class="o">=</span> <span class="n">card_key</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>           <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;card_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s2">&quot;card_number&quot;</span><span class="p">]</span>
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>        <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span>
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>            <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
    <span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="p">[</span><span class="s2">&quot;expire_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s2">&quot;expire_date&quot;</span><span class="p">]</span>
    <span class="n">card</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span>                 <span class="o">=</span> <span class="n">_card</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/cards/update.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">card</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id61">
<div class="code-block-caption"><span class="caption-text">Card Details Page</span><a class="headerlink" href="#id61" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">card_details_page</span><span class="p">(</span><span class="n">card_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">get_card</span><span class="p">(</span><span class="n">card_key</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">card</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/cards/details.html&quot;</span><span class="p">,</span>
      <span class="n">card</span> <span class="o">=</span> <span class="n">card</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-text">My Card Page</span><a class="headerlink" href="#id62" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_card_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">get_card_by_user</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">])</span>
    <span class="k">if</span><span class="p">(</span><span class="n">card</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/cards/details.html&quot;</span><span class="p">,</span>
      <span class="n">card</span> <span class="o">=</span> <span class="n">card</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id6">
<h3>Views<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id63">
<div class="code-block-caption"><span class="caption-text">List Cards if cards exists.</span><a class="headerlink" href="#id63" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Index <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>cards<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-2&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column mr-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;card_add_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Add Card&quot;</span><span class="p">&gt;</span>Add Card<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% if cards %}
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light table-hover&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Surname<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Expire Date<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Points<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Color<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Card Number<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Company<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Operations<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        {% for i in cards %}
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;name&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;surname&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;expire_date&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;points&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;color&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;card_number&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;company&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;card_details_page&#39;, card_key = i[&#39;card_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-info&quot;</span><span class="p">&gt;</span>Details <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;card_update_page&#39;, card_key = i[&#39;card_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-warning&quot;</span><span class="p">&gt;</span>Update<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;card_delete_page&#39;, card_key = i[&#39;card_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-danger&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column mr-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;card_add_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Add Card&quot;</span><span class="p">&gt;</span>Add Card<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  {% endif %}
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id64">
<div class="code-block-caption"><span class="caption-text">Adding Card after join as Boss and if a user is a customer.</span><a class="headerlink" href="#id64" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Create <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>card<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        {% if msg[i] %}
          {% for k in msg[i] %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ k }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
          {% endfor %}
        {% else %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
        {% endif%}
      {% endfor %}
    {% endfor %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5 form-group&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;Username&quot;</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Enter Username<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
      {{ form.username }}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {{ form.card( class_ = &quot; table table-hover&quot;) }}
    
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;cards_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-text">Update details about card.</span><a class="headerlink" href="#id65" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Update <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>card<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        {% if msg[i] %}
          {% for k in msg[i] %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ k }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
          {% endfor %}
        {% else %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
        {% endif%}
      {% endfor %}
    {% endfor %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5 form-group&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;Username&quot;</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Update Username<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
      {{ form.username }}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {{ form.card( class_ = &quot; table table-hover&quot;) }}
    
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;cards_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-text">Confirm the delete operation.</span><a class="headerlink" href="#id66" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Are you sure to delete the card?<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;cards_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-text">Lists details about card and user information</span><a class="headerlink" href="#id67" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{% if card %}
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-12 row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-6&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Card Information {% if card[&#39;is_active&#39;] %} <span class="p">&lt;</span><span class="nt">sup</span><span class="p">&gt;</span>({{ &quot;Active&quot; }})<span class="p">&lt;/</span><span class="nt">sup</span><span class="p">&gt;</span> {% else %} ({{ &quot;Passive&quot; }}) {% endif %}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">hr</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;padding:5px 0;background-color: {{ card[&#39;color&#39;] }}&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Card Number: {{ card[&#39;card_number&#39;] }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Points: {{ card[&#39;points&#39;] }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Activation Date: {{ card[&#39;activation_date&#39;] }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Expire Date: {{ card[&#39;expire_date&#39;] }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Connected to <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;company_details_page&#39;, company_key = card[&#39;company_id&#39;]) }}&quot;</span> <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="p">&gt;</span>{{ card[&#39;name&#39;] }} company<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Company Information: {{card[&#39;company_information&#39;]}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-6&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4 pb-1&quot;</span><span class="p">&gt;</span>User Information<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">hr</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;padding:5px 0;background-color: {{ card[&#39;color&#39;] }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5&quot;</span><span class="p">&gt;</span>
          
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ card[&#39;path&#39;] }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;img-fluid round-circle&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;250&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;250&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Card Owner: {{ card[&#39;person_name&#39;]  }}  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Gender: {{ card[&#39;gender&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Birthday: {{ card[&#39;birthday&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Education Level: {{ card[&#39;educationlevel&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="order">
<h2>ORDER<a class="headerlink" href="#order" title="Permalink to this headline">¶</a></h2>
<p>Order class is connected to restaurant for meals and user account for who ordered the meals.</p>
<ul class="simple">
<li><p>Primary Key: ORDER_ID</p></li>
<li><p>Non-relational Key</p>
<ul>
<li><p>PRICE( total price )</p></li>
<li><p>NOTE</p></li>
<li><p>TYPE( CASH OR CREDIT CARD )</p></li>
<li><p>RATE</p></li>
<li><p>CREATED_AT( now )</p></li>
<li><p>END_AT</p></li>
<li><p>is_delivered( 0 means not delievered )</p></li>
</ul>
</li>
<li><p>Foreign Key(table_name)</p>
<ul>
<li><p>RESTAURANT_ID(RESTAURANT)</p></li>
<li><p>USER_ID(USERACCOUNT)</p></li>
</ul>
</li>
</ul>
<div class="section" id="id7">
<h3>Database Functions<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-text">This method get all orders in <strong>index page of order</strong></span><a class="headerlink" href="#id68" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_all_orders</span><span class="p">():</span>
  <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from orders&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">orders</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-text">This method get order in <strong>detail page of order</strong> by type such as restaurant, user or order key.</span><a class="headerlink" href="#id69" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_order</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
  <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;restaurant&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from orders where restaurant_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from orders where user_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from orders where order_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">orders</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-text">This method get order food details in <strong>detail page of order</strong> by type such as restaurant, user or order key.</span><a class="headerlink" href="#id70" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_detailed_order_food</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
  <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;restaurant&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select food_name, brand_name, amount, f.price as price from orders as o full join order_food as of on of.order_id = o.order_id full join food as f on of.food_id = f.food_id where restaurant_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select food_name, brand_name, amount, f.price as price from orders as o full join order_food as of on of.order_id = o.order_id full join food as f on of.food_id = f.food_id where user_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select food_name, brand_name, amount, f.price as price from orders as o full join order_food as of on of.order_id = o.order_id full join food as f on of.food_id = f.food_id where o.order_id = </span><span class="si">%s</span><span class="s2"> order by end_at desc;&quot;</span>
      
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">orders</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-text">This method get order details in <strong>detail page of order</strong></span><a class="headerlink" href="#id71" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_order_details</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select note, price, o.type as payment_type, created_at, end_at, manager, CONCAT(p.name, &#39; &#39;, p.surname) as person_name from orders as o full join restaurant as r on o.restaurant_id = r.restaurant_id full join useraccount as u on u.id = o.user_id full join person as p on p.id = u.person where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">order_key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">card</span> <span class="p">))</span>
  <span class="k">return</span> <span class="n">res</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-text">This method get comments of the order in <strong>detail page of order</strong></span><a class="headerlink" href="#id72" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_order_related_comments</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
  <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select title, description, case speed when 0 then &#39;Slow&#39; else &#39;Fast&#39; end as speed, case taste when 0 then &#39;Not tasteful&#39; else &#39;Tasteful&#39; end as taste, CONCAT(p.name, &#39; &#39;, p.surname) as person_name from comment as c full join useraccount as u on u.id = c.user_id full join person as p on p.id = u.person where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">orders</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-text">This method add order in <strong>payment page of order</strong></span><a class="headerlink" href="#id73" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_order</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
  <span class="n">order_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into orders(price, note, type, rate, end_at, created_at, restaurant_id, user_id) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) RETURNING order_id;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
      <span class="n">order_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">order_id</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-text">This method update order in <strong>update page of order</strong></span><a class="headerlink" href="#id74" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_order</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update orders set price = </span><span class="si">%s</span><span class="s2">, note = </span><span class="si">%s</span><span class="s2">, type = </span><span class="si">%s</span><span class="s2">, rate = </span><span class="si">%s</span><span class="s2">, end_at = </span><span class="si">%s</span><span class="s2"> where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id75">
<div class="code-block-caption"><span class="caption-text">This method delete order in <strong>cancel page of order</strong></span><a class="headerlink" href="#id75" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_order</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from orders where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">order_key</span><span class="p">,)</span> <span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id8">
<h3>Other functions<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-text">This method update <strong>the delivered status</strong> of the order.</span><a class="headerlink" href="#id76" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_order_delivered</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update orders set is_delivered = 1 where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-text">This method calls if the order is delivered to customer, the stock update function from stock model to decrease the amount of foods.</span><a class="headerlink" href="#id77" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_stock_by_order_key</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>
  <span class="n">food_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select food_id, amount from order_food where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="p">))</span>
      <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
          <span class="n">update_stock</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id9">
<h3>Forms<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>OrderForm is used in pages.</p>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-text">import section of order_form</span><a class="headerlink" href="#id78" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">RadioField</span><span class="p">,</span> <span class="n">DecimalField</span><span class="p">,</span> <span class="n">SubmitField</span><span class="p">,</span> <span class="n">FormField</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">FieldList</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span><span class="p">,</span> <span class="n">Length</span>
<span class="c1">#from wtforms.fields.html5 import DateField</span>
<span class="kn">from</span> <span class="nn">wtforms.fields.html5</span> <span class="kn">import</span> <span class="n">DateTimeLocalField</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">..forms.users_form</span> <span class="kn">import</span> <span class="n">UserAccountForm</span><span class="p">,</span> <span class="n">ContactInfoForm</span><span class="p">,</span> <span class="n">PersonForm</span>

<span class="kn">from</span> <span class="nn">models.users</span> <span class="kn">import</span> <span class="n">select_users</span>

<span class="n">msgRequired</span> <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> must be filled.&quot;</span>
<span class="n">msgChosen</span>   <span class="o">=</span> <span class="s2">&quot;Must choose one </span><span class="si">{}</span><span class="s2"> of them.&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-text">Order class for Form</span><a class="headerlink" href="#id79" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">note</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="s2">&quot;Note&quot;</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">)</span> <span class="p">)],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
  
  <span class="n">price</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="s2">&quot;Price&quot;</span><span class="p">,</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;form-control&quot;</span><span class="p">,</span> <span class="s2">&quot;readonly&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
  <span class="p">)</span>

  <span class="n">payment_type</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="s2">&quot;Payment Type&quot;</span><span class="p">,</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;CASH&quot;</span><span class="p">,</span> <span class="s2">&quot;Cash&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;CREDIT&quot;</span><span class="p">,</span> <span class="s2">&quot;Credit Card&quot;</span><span class="p">)],</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;payment type&quot;</span><span class="p">))</span> <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span><span class="p">}</span>
  <span class="p">)</span>

  <span class="n">end_at</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="s1">&#39;End Datetime&#39;</span><span class="p">,</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M&#39;</span><span class="p">,</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">(</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span> <span class="p">),</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">rate</span> <span class="o">=</span> <span class="n">RadioField</span><span class="p">(</span>
    <span class="s2">&quot;Rate&quot;</span><span class="p">,</span>
    <span class="n">default</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">coerce</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">),</span> <span class="p">],</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">))],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;list-group list-group-horizontal&quot;</span> <span class="p">}</span>
  <span class="p">)</span>

</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id80">
<div class="code-block-caption"><span class="caption-text">OrderForm includes Order class</span><a class="headerlink" href="#id80" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OrderForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">order</span>     <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
  <span class="n">submit</span>    <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span> <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id10">
<h3>Pages<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Pages connected to forms, views and call database operations.</p>
<div class="literal-block-wrapper docutils container" id="id81">
<div class="code-block-caption"><span class="caption-text">Order Index Page</span><a class="headerlink" href="#id81" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">orders_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">orders</span> <span class="o">=</span> <span class="n">get_all_orders</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/orders/index.html&quot;</span><span class="p">,</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">,</span>
      <span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id82">
<div class="code-block-caption"><span class="caption-text">Payment Page</span><a class="headerlink" href="#id82" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">payment_page</span><span class="p">(</span><span class="n">meals</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">meals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    
    <span class="n">meals_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">restaurant_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meals</span><span class="p">:</span>
      <span class="n">food</span>          <span class="o">=</span> <span class="n">select_restaurant_price</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
      <span class="n">name</span>          <span class="o">=</span> <span class="n">food</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">## food name</span>
      <span class="n">restaurant_id</span> <span class="o">=</span> <span class="n">food</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">## restaurant_id</span>
      <span class="n">price</span>         <span class="o">=</span> <span class="n">food</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">## food price</span>
      <span class="n">stock</span>         <span class="o">=</span> <span class="n">max_meal_possible</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">meals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">price</span> <span class="p">)</span> <span class="p">)</span>

    <span class="n">order</span> <span class="o">=</span> <span class="n">OrderForm</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      
      <span class="n">ar</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meals_list</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount_of_check_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">)</span> 

      <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]</span>

      <span class="n">order_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;payment_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;end_at&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="n">restaurant_id</span><span class="p">,</span>
        <span class="n">user_id</span>
      <span class="p">)</span>

      <span class="n">order_key</span> <span class="o">=</span> <span class="n">add_order</span><span class="p">(</span><span class="n">order_info</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="p">)):</span>
        <span class="n">connect_order_and_food</span><span class="p">(</span> <span class="p">(</span><span class="n">order_key</span><span class="p">,</span> <span class="n">meals_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
      
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;my_orders_page&quot;</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/payment.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span>
      <span class="n">meals</span> <span class="o">=</span> <span class="n">meals_list</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id83">
<div class="code-block-caption"><span class="caption-text">Order Cancel Page</span><a class="headerlink" href="#id83" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">order_cancel_page</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
      <span class="n">delete_order</span><span class="p">(</span><span class="n">order_key</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;orders_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;/orders/cancel.html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id84">
<div class="code-block-caption"><span class="caption-text">Order Update Page</span><a class="headerlink" href="#id84" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">order_update_page</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    
    <span class="n">order</span> <span class="o">=</span> <span class="n">OrderForm</span><span class="p">()</span>
    
    <span class="n">_order</span> <span class="o">=</span> <span class="n">get_order</span><span class="p">(</span><span class="n">order_key</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      
      <span class="n">order_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;payment_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;end_at&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">order_key</span>
      <span class="p">)</span>

      <span class="n">update_order</span><span class="p">(</span><span class="n">order_info</span><span class="p">)</span>
      
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;order_details_page&quot;</span><span class="p">,</span> <span class="n">order_key</span> <span class="o">=</span> <span class="n">order_key</span><span class="p">))</span>

    <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_order</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
    <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_order</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span>
    <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;payment_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_order</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
    <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_order</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span>
    <span class="n">order</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;end_at&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_order</span><span class="p">[</span><span class="s2">&quot;end_at&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/edit.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">order</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id85">
<div class="code-block-caption"><span class="caption-text">Order Details Page</span><a class="headerlink" href="#id85" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">order_details_page</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>

  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">get_detailed_order_food</span><span class="p">(</span><span class="n">order_key</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">get_order_related_comments</span><span class="p">(</span><span class="n">order_key</span><span class="p">)</span>
    <span class="n">order_details</span> <span class="o">=</span> <span class="n">get_order_details</span><span class="p">(</span><span class="n">order_key</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;not_found_page&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/details.html&quot;</span><span class="p">,</span>
      <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span>
      <span class="n">comments</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span>
      <span class="n">order_detail</span> <span class="o">=</span> <span class="n">order_details</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id86">
<div class="code-block-caption"><span class="caption-text">My Orders Page shows ordered meals and details about it.</span><a class="headerlink" href="#id86" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_orders_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>

    <span class="n">myorders</span> <span class="o">=</span> <span class="n">get_order</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;userid&quot;</span><span class="p">],</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/myorders.html&quot;</span><span class="p">,</span>
      <span class="n">myorders</span> <span class="o">=</span> <span class="n">myorders</span><span class="p">,</span>
      <span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id87">
<div class="code-block-caption"><span class="caption-text">if the method is POST, Order Delivered be called and update the delivered status as 1 and call the update stock function to decrease the stock size.</span><a class="headerlink" href="#id87" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_orders_page</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>

    <span class="n">myorders</span> <span class="o">=</span> <span class="n">get_order</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;userid&quot;</span><span class="p">],</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/myorders.html&quot;</span><span class="p">,</span>
      <span class="n">myorders</span> <span class="o">=</span> <span class="n">myorders</span><span class="p">,</span>
      <span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id11">
<h3>Views<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id88">
<div class="code-block-caption"><span class="caption-text">List Orders if orders exists.</span><a class="headerlink" href="#id88" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>All <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>orders<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-2&quot;</span><span class="p">&gt;</span>
    {% if orders %}
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light table-hover&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>#<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Price<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Note<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Type<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Rate<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Start Date<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>End Date<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        {% for i in orders %}
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;order_id&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;price&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;note&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;type&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;rate&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;created_at&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;end_at&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;comment_order_page&#39;, order_key = i[&#39;order_id&#39;] ) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-dark&quot;</span><span class="p">&gt;</span>Make Comment <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;order_update_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-warning&quot;</span><span class="p">&gt;</span>Update Order <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;order_cancel_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-danger&quot;</span><span class="p">&gt;</span>Cancel Order <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;order_details_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-info&quot;</span><span class="p">&gt;</span>Details <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id89">
<div class="code-block-caption"><span class="caption-text">Get the list from meal page then put the values to views with javascript. Then, the customer sells the food by selecting the amount and the order is starting.</span><a class="headerlink" href="#id89" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;payment_list&quot;</span><span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[i][0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endfor %}
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Payment <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>page<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Meal Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Stock<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Price<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        {% set count = namespace(value=0) %}
        {% for i in meals %}
          {% set count.value = count.value + 1 %}
          <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[1] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">data-key</span><span class="o">=</span><span class="s">&quot;{{ i[0] }}&quot;</span> <span class="na">data-price</span><span class="o">=</span><span class="s">&quot;{{ i[3] }}&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;amount_of_check_{{ count.value }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;amount_of_check&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;amount_of_check_{{ count.value }}&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">1</span> <span class="na">min</span><span class="o">=</span><span class="s">1</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;{{ i[2]}}&quot;</span> <span class="p">&gt;</span> 
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[3] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor%}
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    {{ form.order( class_ = &quot;mt-5 table table-hover&quot;) }}
    
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;orders_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">vale</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;amount_of_check&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">allsum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">vale</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">itm</span>  <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">vale</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-price&#39;</span><span class="p">))</span>
      <span class="kd">var</span> <span class="nx">stock</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">vale</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
      <span class="nx">allsum</span> <span class="o">=</span> <span class="nx">allsum</span> <span class="o">+</span> <span class="nx">itm</span> <span class="o">*</span> <span class="nx">stock</span>
    <span class="p">}</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">&quot;order-price&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">allsum</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.amount_of_check&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">vale</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;amount_of_check&quot;</span><span class="p">)</span>
      <span class="kd">var</span> <span class="nx">allsum</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">vale</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">itm</span>  <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">vale</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-price&#39;</span><span class="p">))</span>
        <span class="kd">var</span> <span class="nx">stock</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">vale</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
        <span class="nx">allsum</span> <span class="o">=</span> <span class="nx">allsum</span> <span class="o">+</span> <span class="nx">itm</span> <span class="o">*</span> <span class="nx">stock</span>
      <span class="p">}</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">&quot;order-price&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">allsum</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">})</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id90">
<div class="code-block-caption"><span class="caption-text">Update details about order.</span><a class="headerlink" href="#id90" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span><span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[i][0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endfor %}
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Update <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>order<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    
    {{ form.order( class_ = &quot;mt-5 table table-hover&quot;) }}
    
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;orders_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id91">
<div class="code-block-caption"><span class="caption-text">The customer can cancel if the date between starting date and end date is not over.</span><a class="headerlink" href="#id91" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Do you wanna really cancel your order?<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;orders_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id92">
<div class="code-block-caption"><span class="caption-text">Lists details about order</span><a class="headerlink" href="#id92" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{% if order %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-8&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Meal Details<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light table-hover&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Food Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Brand Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Amount<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Price by food<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        {% for i in order %}
          <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;food_name&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;brand_name&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;amount&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;price&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor%}
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-4&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Order Details<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
      {% if order_detail %}
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
        
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group list-group-flush&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Note: {{ order_detail[&#39;note&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Total Price: {{ order_detail[&#39;price&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Payment Type: {{ order_detail[&#39;payment_type&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Order Date: {{ order_detail[&#39;created_at&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Delivery Date: {{ order_detail[&#39;end_at&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Restaurant Manager: {{ order_detail[&#39;manager&#39;] }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;list-group-item&quot;</span><span class="p">&gt;</span>Ordered by {{ order_detail[&#39;person_name&#39;] }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      {% endif %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4 &quot;</span><span class="p">&gt;</span>Comments<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-light table-hover&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Person Info<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Speed<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Taste<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
      {% for i in comments %}
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;title&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;description&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;person_name&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;speed&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ i[&#39;taste&#39;] }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      {% endfor %}
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endif %}
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id93">
<div class="code-block-caption"><span class="caption-text">Lists details about order by the users</span><a class="headerlink" href="#id93" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;div class=&quot;container&quot;&gt;
  &lt;h1 class=&quot;display-4&quot;&gt;My &lt;small class=&quot;text-muted font-italic&quot;&gt;orders&lt;/small&gt;&lt;/h1&gt;
  &lt;hr&gt;
&lt;/div&gt;

&lt;div class=&quot;container mt-2&quot;&gt;
    {% if myorders %}
    &lt;table class=&quot;table table-light table-hover&quot;&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;#&lt;/th&gt;
          &lt;th&gt;Price&lt;/th&gt;
          &lt;th&gt;Note&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Rate&lt;/th&gt;
          &lt;th&gt;Start Date&lt;/th&gt;
          &lt;th&gt;End Date&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        {% for i in myorders %}
        &lt;tr&gt;
          &lt;td&gt;{{ i[&#39;order_id&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;price&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;note&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;type&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;rate&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;created_at&#39;] }}&lt;/td&gt;
          &lt;td&gt;{{ i[&#39;end_at&#39;] }}&lt;/td&gt;
          &lt;td&gt;
            {% if i[&#39;end_at&#39;] &lt; date_now %}
              {% if i[&#39;is_delivered&#39;] == 0 %}
              &lt;form action=&quot;{{ url_for(&#39;order_delivered_page&#39;) }}&quot; method=&quot;POST&quot;&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;order_key&quot; value=&quot;{{ i[&#39;order_id&#39;] }}&quot;&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn btn-outline-dark&quot;&gt;Deliver&lt;/button&gt;
              &lt;/form&gt;
              {% else %}
                &lt;a href=&quot;{{ url_for(&#39;comment_order_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot; class=&quot;btn btn-outline-dark&quot;&gt;Make Comment &lt;/a&gt;
              {% endif %}
            {% else %}
              &lt;a href=&quot;{{ url_for(&#39;order_update_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot; class=&quot;btn btn-outline-warning&quot;&gt;Update Order &lt;/a&gt;
              &lt;a href=&quot;{{ url_for(&#39;order_cancel_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot; class=&quot;btn btn-outline-danger&quot;&gt;Cancel Order &lt;/a&gt;
            {% endif %}
            &lt;a href=&quot;{{ url_for(&#39;order_details_page&#39;, order_key = i[&#39;order_id&#39;]) }}&quot; class=&quot;btn btn-outline-info&quot;&gt;Details &lt;/a&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
        {% endfor %}
      &lt;/tbody&gt;
    &lt;/table&gt;
    {% endif %}
&lt;/div&gt;
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="order-food">
<h2>ORDER_FOOD<a class="headerlink" href="#order-food" title="Permalink to this headline">¶</a></h2>
<p>Order food class is connected to restaurant for meals and user account for who ordered the meals.</p>
<ul class="simple">
<li><p>Primary Key: ORDER_ID, FOOD_ID</p></li>
<li><p>Non-relational Key: AMOUNT( ordered food amount )</p></li>
<li><p>Foreign Key(table_name)</p>
<ul>
<li><p>FOOD_ID(FOOD)</p></li>
<li><p>ORDER_ID(ORDERS)</p></li>
</ul>
</li>
</ul>
<div class="section" id="id12">
<h3>Database Functions<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id94">
<div class="code-block-caption"><span class="caption-text">This method connect food and order in one table with the amount of food.</span><a class="headerlink" href="#id94" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_order_and_food</span><span class="p">(</span><span class="n">orderfood</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into order_food(order_id, food_id, amount) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">orderfood</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="comment">
<h2>COMMENT<a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h2>
<p>Comment class is connected to delivered order and user account who comment.</p>
<ul class="simple">
<li><p>Primary Key: COMMENT_ID</p></li>
<li><p>Non-relational Key</p>
<ul>
<li><p>TITLE</p></li>
<li><p>DESCRIPTION</p></li>
<li><p>CREATED_AT( now )</p></li>
<li><p>SPEED ( 0=slow : 1=fast )</p></li>
<li><p>TASTE( 0=tasteful : 1=not tasteful )</p></li>
</ul>
</li>
<li><p>Foreign Key(table_name)</p>
<ul>
<li><p>ORDER_ID(ORDERS)</p></li>
<li><p>USER_ID(USERACCOUNT)</p></li>
</ul>
</li>
</ul>
<div class="section" id="id13">
<h3>Database Functions<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id95">
<div class="code-block-caption"><span class="caption-text">This method provides to comment the order.</span><a class="headerlink" href="#id95" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_comment_to_order</span><span class="p">(</span><span class="n">comment</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into comment(title, description, speed, taste, user_id, order_id) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
      <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id96">
<div class="code-block-caption"><span class="caption-text">This method get comments of the order in <strong>detail page of order</strong></span><a class="headerlink" href="#id96" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_order_related_comments</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
  <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select title, description, case speed when 0 then &#39;Slow&#39; else &#39;Fast&#39; end as speed, case taste when 0 then &#39;Not tasteful&#39; else &#39;Tasteful&#39; end as taste, CONCAT(p.name, &#39; &#39;, p.surname) as person_name from comment as c full join useraccount as u on u.id = c.user_id full join person as p on p.id = u.person where order_id = </span><span class="si">%s</span><span class="s2">;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
      <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))</span> <span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">res</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">orders</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id14">
<h3>Forms<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>CommentForm is used in pages.</p>
<div class="literal-block-wrapper docutils container" id="id97">
<div class="code-block-caption"><span class="caption-text">import section of comment_form</span><a class="headerlink" href="#id97" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">SubmitField</span><span class="p">,</span> <span class="n">FormField</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">FloatField</span><span class="p">,</span> <span class="n">BooleanField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span><span class="p">,</span> <span class="n">NumberRange</span><span class="p">,</span> <span class="n">Length</span>
<span class="kn">from</span> <span class="nn">wtforms_components</span> <span class="kn">import</span> <span class="n">IntegerField</span>

<span class="n">msgRequired</span> <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> must be filled.&quot;</span>
<span class="n">msgLength</span>   <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> has to be between </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id98">
<div class="code-block-caption"><span class="caption-text">Comment class for Form</span><a class="headerlink" href="#id98" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="s2">&quot;Title&quot;</span><span class="p">,</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> 
      <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">)),</span>
      <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">msgLength</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
  
  <span class="n">description</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="s2">&quot;Description&quot;</span><span class="p">,</span> 
    <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span> 
      <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">msgRequired</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">)),</span>
      <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">msgLength</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
    <span class="p">],</span>
    <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="p">}</span>
  <span class="p">)</span>
  <span class="c1">#BooleanField = checkbox</span>

  <span class="n">speed</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span>
    <span class="s2">&quot;speed&quot;</span>
  <span class="p">)</span>
  <span class="n">taste</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span>
    <span class="s2">&quot;taste&quot;</span>
  <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id99">
<div class="code-block-caption"><span class="caption-text">CommentForm includes Comment class</span><a class="headerlink" href="#id99" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommentForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
  <span class="n">comment</span> <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span><span class="n">Comment</span><span class="p">)</span>
  <span class="n">submit</span>  <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span> <span class="n">render_kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;class&quot;</span> <span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id15">
<h3>Pages<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Pages connected to forms, views and call database operations.</p>
<div class="literal-block-wrapper docutils container" id="id100">
<div class="code-block-caption"><span class="caption-text">Comment to Order</span><a class="headerlink" href="#id100" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">comment_order_page</span><span class="p">(</span><span class="n">order_key</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;logged_in&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;signin_page&#39;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>

    <span class="n">comment</span> <span class="o">=</span> <span class="n">CommentForm</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
      
      <span class="n">user_id</span>     <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]</span>

      <span class="n">comment_info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">comment</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">comment</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">comment</span><span class="o">.</span><span class="n">comment</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">comment</span><span class="o">.</span><span class="n">comment</span><span class="p">[</span><span class="s2">&quot;taste&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">order_key</span>
      <span class="p">)</span>

      <span class="n">make_comment_to_order</span><span class="p">(</span><span class="n">comment_info</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;order_details_page&quot;</span><span class="p">,</span> <span class="n">order_key</span> <span class="o">=</span> <span class="n">order_key</span><span class="p">))</span>
      
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
      <span class="s2">&quot;/orders/comment.html&quot;</span><span class="p">,</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">comment</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id16">
<h3>Views<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id101">
<div class="code-block-caption"><span class="caption-text">Creating a comment page.</span><a class="headerlink" href="#id101" title="Permalink to this code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display-4&quot;</span><span class="p">&gt;</span>Make comment to <span class="p">&lt;</span><span class="nt">small</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted font-italic&quot;</span><span class="p">&gt;</span>order<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ request.path }}&quot;</span> <span class="p">&gt;</span>
    {{ form.csrf_token }}
    
    {% for field, msg in form.errors.items() %}
      {% for i in msg: %}
        {% if msg[i] %}
          {% for k in msg[i] %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ k }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
          {% endfor %}
        {% else %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-warning&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ msg[0] }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
        {% endif%}
      {% endfor %}
    {% endfor %}
    {{ form.comment( class_ = &quot; table table-hover&quot;) }}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
      {{ form.submit }}
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;home_page&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<dl class="citation">
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id1">util.py</a></span></dt>
<dd><p><a class="reference external" href="https://exploreflask.com/en/latest/views.html#custom-converters">https://exploreflask.com/en/latest/views.html#custom-converters</a></p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="member4.html" class="btn btn-neutral float-right" title="Parts Implemented by Uğur Demir" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="member2.html" class="btn btn-neutral float-left" title="Parts Implemented by Metehan Seyran" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ITUCSDB1951

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>